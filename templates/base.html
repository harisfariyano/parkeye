<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>{% block title %}| Parking (AI) System{% endblock %}</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- favicon
		============================================ -->
  <link rel="shortcut icon" type="image/x-icon" href="../static/img/logo/parkeye-favicon-white.png">
  <!-- Google Fonts
		============================================ -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
  <!-- SweetAlert CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <!-- SweetAlert JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Bootstrap CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/bootstrap.min.css">
  <!-- font awesome CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/font-awesome.min.css">
  <!-- owl.carousel CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/owl.carousel.css">
  <link rel="stylesheet" href="../static/css/owl.theme.css">
  <link rel="stylesheet" href="../static/css/owl.transitions.css">
  <!-- meanmenu CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/meanmenu/meanmenu.min.css">
  <!-- animate CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/animate.css">
  <!-- normalize CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/normalize.css">
  <!-- wave CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/wave/waves.min.css">
  <link rel="stylesheet" href="../static/css/wave/button.css">
  <!-- mCustomScrollbar CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/scrollbar/jquery.mCustomScrollbar.min.css">
  <!-- Notika icon CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/notika-custom-icon.css">
  <!-- Data Table JS
		============================================ -->
  <link rel="stylesheet" href="../static/css/jquery.dataTables.min.css">
  <!-- main CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/main.css">
  <!-- style CSS
		============================================ -->
  <link rel="stylesheet" href="../static/style.css">
  <!-- responsive CSS
		============================================ -->
  <link rel="stylesheet" href="../static/css/responsive.css">
  <!-- modernizr JS
		============================================ -->
  <script src="../static/js/vendor/modernizr-2.8.3.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <style>
    .loader {
      border: 6px solid #f3f3f3;
      border-radius: 50%;
      border-top: 6px solid #3498db;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
      display: none;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  {% block content %}{% endblock %}
  <!-- Logout Modal -->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave {{ username }}?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">Kamu srius ingin meninggalkan Parking (AI) System ?</div>
        <div class="modal-footer">
          <button class="btn btn-danger notika-btn-danger" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" id="logoutButton" href="{{ url_for('logout') }}">Logout</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Logout Modal -->
  <!-- Start Footer area-->
  <div class="footer-copyright-area">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="footer-copy-right">
            <p>Copyright Â© 2018
              . All rights reserved. Template by <a href="https://colorlib.com">Colorlib</a>.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Footer area-->
  <!-- jquery
  ============================================ -->
  <script src="../static/js/vendor/jquery-1.12.4.min.js"></script>
  <!-- bootstrap JS
  ============================================ -->
  <script src="../static/js/bootstrap.min.js"></script>
  <!-- wow JS
  ============================================ -->
  <script src="../static/js/wow.min.js"></script>
  <!-- price-slider JS
  ============================================ -->
  <script src="../static/js/jquery-price-slider.js"></script>
  <!-- owl.carousel JS
  ============================================ -->
  <script src="../static/js/owl.carousel.min.js"></script>
  <!-- scrollUp JS
  ============================================ -->
  <script src="../static/js/jquery.scrollUp.min.js"></script>
  <!-- meanmenu JS
  ============================================ -->
  <script src="../static/js/meanmenu/jquery.meanmenu.js"></script>
  <!-- counterup JS
  ============================================ -->
  <script src="../static/js/counterup/jquery.counterup.min.js"></script>
  <script src="../static/js/counterup/waypoints.min.js"></script>
  <script src="../static/js/counterup/counterup-active.js"></script>
  <!-- mCustomScrollbar JS
  ============================================ -->
  <script src="../static/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
  <!-- sparkline JS
  ============================================ -->
  <script src="../static/js/sparkline/jquery.sparkline.min.js"></script>
  <script src="../static/js/sparkline/sparkline-active.js"></script>
  <!-- flot JS
  ============================================ -->
  <script src="../static/js/flot/jquery.flot.js"></script>
  <script src="../static/js/flot/jquery.flot.resize.js"></script>
  <script src="../static/js/flot/flot-active.js"></script>
  <!-- knob JS
  ============================================ -->
  <script src="../static/js/knob/jquery.knob.js"></script>
  <script src="../static/js/knob/jquery.appear.js"></script>
  <script src="../static/js/knob/knob-active.js"></script>
  <!--  Chat JS
  ============================================ -->
  <script src="../static/js/chat/jquery.chat.js"></script>
  <!--  todo JS
  ============================================ -->
  <script src="../static/js/todo/jquery.todo.js"></script>
  <!--  wave JS
  ============================================ -->
  <script src="../static/js/wave/waves.min.js"></script>
  <script src="../static/js/wave/wave-active.js"></script>
  <!-- plugins JS
  ============================================ -->
  <script src="../static/js/plugins.js"></script>
  <!-- Data Table JS
  ============================================ -->
  <script src="../static/js/data-table/jquery.dataTables.min.js"></script>
  <script src="../static/js/data-table/data-table-act.js"></script>
  <!-- main JS
  ============================================ -->
  <script src="../static/js/main.js"></script>
  <!-- End Sale Statistic area-->
  <script>
    function toggleSourceInput() {
      var source = document.getElementById('sourceSelect').value;
      document.getElementById('ipInput').style.display = source === 'ip' ? 'block' : 'none';
      document.getElementById('fileInput').style.display = source === 'file' ? 'block' : 'none';
      hideUploadMessage();
    }

    function autoUpload() {
      var fileInput = document.getElementById('videoFile');
      if (fileInput.files.length > 0) {
        var formData = new FormData();
        formData.append('video_file', fileInput.files[0]);

        // Show loader animation
        document.getElementById('uploadLoader').style.display = 'block';
        document.getElementById('uploadMessage').style.display = 'none';

        fetch('/upload_video', {
          method: 'POST',
          body: formData
        }).then(response => response.json())
          .then(data => {
            if (data.success) {
              // Hide loader animation
              document.getElementById('uploadLoader').style.display = 'none';
              document.getElementById('uploadMessage').style.display = 'block';
              document.getElementById('videoStream').src = '/video_feed?source_type=file&source=' + data.file_path.split('/').pop();
              document.getElementById('startButton').style.display = 'inline';
              document.getElementById('stopButton').style.display = 'none';
            } else {
              // Hide loader animation on failure
              document.getElementById('uploadLoader').style.display = 'none';
              alert('Video upload failed: ' + data.message);
            }
          });
      }
    }

    function startStream() {
      var source = document.getElementById('sourceSelect').value;
      var src = '';

      if (source === 'ip') {
        src = document.getElementById('ipLink').value;
        if (!src) {
          alert('Please enter IP Camera link.');
          return;
        }
      } else if (source === 'file') {
        src = 'uploaded_video.mp4';
      }

      if (src) {
        document.getElementById('videoStream').src = '/video_feed?source_type=' + source + '&source=' + src;
        document.getElementById('startButton').style.display = 'none';
        document.getElementById('stopButton').style.display = 'inline';
      } else {
        alert('Please provide a valid source.');
      }
    }

    function stopStream() {
      fetch('/stop_feed')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById('videoStream').src = '/current_frame';
            document.getElementById('startButton').style.display = 'inline';
            document.getElementById('stopButton').style.display = 'none';
            stopAlarm();
          }
        });
    }

    function stopAlarm() {
      fetch('/stop_alarm')
        .then(response => response.json());
    }

    function resetPage() {
      stopAlarm();
      document.getElementById('sourceSelect').value = 'none';
      document.getElementById('ipLink').value = '';
      document.getElementById('videoFile').value = '';
      document.getElementById('ipInput').style.display = 'none';
      document.getElementById('fileInput').style.display = 'none';
      document.getElementById('videoStream').src = '';
      document.getElementById('startButton').style.display = 'inline';
      document.getElementById('stopButton').style.display = 'none';
      hideUploadMessage();
    }

    function hideUploadMessage() {
      document.getElementById('uploadMessage').style.display = 'none';
    }
  </script>
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>